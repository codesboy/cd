<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>新增客户</title>
<link  rel="stylesheet" type="text/css" />
<!-- <link rel="stylesheet" href="__PUBLIC__static/bootstrap/css/bootstrap.min.css"> -->
<link href="__PUBLIC__static/easyui/css/easyui.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__static/easyui/css/icon.css" rel="stylesheet" type="text/css" />
<script src="__PUBLIC__static/easyui/js/jquery.min.js" type="text/javascript"></script>
<script src="__PUBLIC__static/easyui/js/jquery.easyui.min.js" type="text/javascript"></script>
<script src="__PUBLIC__static/easyui/js/easyui-lang-zh_CN.js" type="text/javascript"></script>
<!-- <script src="__PUBLIC__static/bootstrap/js/bootstrap.min.js"></script> -->

<style>
    span.tit{display: inline-block;width: 100px;text-align: right;}
    form{font-size: 14px;font-family: 微软雅黑;}
    .combobox-item{cursor: pointer}
</style>
</head>
<body>
    <center>
        <div style="margin:20px 0;"></div>
        <div class="easyui-panel" title="用户基本信息" style="width:auto;">
            <div style="padding:10px 20px 20px 20px">
            <form action="{:url('useradd')}" id="useradd" class="easyui-form" method="post" data-options="novalidate:true">
                <table cellpadding="5">
                    <tr>
                        <td>
                            <span class="tit">姓&emsp;&emsp;名：</span>
                            <input id="name" class="easyui-validatebox easyui-textbox" type="text" name="name" required="true"></input>
                        </td>
                        <td>
                            <span class="tit">性&emsp;&emsp;别：</span>
                            <select id="sex" class="easyui-combobox" name="sex" required="true" data-options="panelHeight:'auto',editable:false" validType="comboxValidate['sex','请选择性别']">
                                <option value="">-------------选择性别-----------</option>
                                <option value="1">男</option>
                                <option value="2">女</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="tit">出生日期：</span>
                            <input id="birthday" class="easyui-datebox" name="birthday" required="true" type="text"></input>
                        </td>
                        <td>
                            <span class="tit">手机号码：</span>
                            <input id="tel" class="easyui-textbox" type="text" name="tel" required="true"></input>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="tit">省&emsp;&emsp;份：</span>
                            <select name="province_id" id="userAttrArea" required="true" class="easyui-combobox" style="width:auto">
                                <option value="">------------请选择省------------</option>
                                {volist name='province' id="f"}
                                <option value="{$f.province_id}">{$f.province_name}</option>
                                {/volist}
                            </select>
                        </td>
                        <td>
                            <span class="tit">市&emsp;&emsp;级：</span>
                            <input name="city_id" id="userAttrCity" class="easyui-combobox" required="true">
                            </input>
                        </td>
                        <td>
                            <span class="tit">区&emsp;&emsp;县：</span>
                            <input name="county_id" id="userAttrCounty" class="easyui-combobox" required="true" type="text">
                            </input>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="tit">开发渠道：</span>
                            <select id="deva" class="easyui-validatebox easyui-combobox" name="dev" required="true" data-options="required:true,panelHeight:'auto',editable:false">
                                <option value="">--------------请选择-------------</option>
                                {volist name="dev" id="e" }
                                <option value="{$e.id}">{$e.dev}</option>
                                {/volist}
                            </select>
                        </td>
                        <td>
                            <span class="tit">信息来源：</span>
                            <input id="from" class="easyui-combobox" name="from" required="true" data-options="required:true,panelHeight:'auto',editable:false" validType="comboxValidate['from','请选择信息来源']">

                            </input>
                        </td>
                        <td>
                            <span class="tit">咨询工具：</span>
                            <select id="tool" class="easyui-combobox" name="tool" data-options="required:true,panelHeight:'auto',editable:false" validType="comboxValidate['tool','请选择咨询工具']">
                                <option value="0">--------------请选择-------------</option>
                                {volist name="zx_tools" id="b" }
                                <option value="{$b.id}">{$b.tool}</option>
                                {/volist}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <p style="border-bottom: 1px solid #ccc;text-align: center;color: #888;">以上是客户基本信息</p>
                        </td>
                    </tr>
                    <tr>

                        <td>
                            <span class="tit">网电咨询师：</span>
                            <select id="disease" class="easyui-combobox" name="disease" data-options="required:true,panelHeight:'auto',editable:false" validType="comboxValidate['disease','请选择咨询病种']">
                                <option value="0">--------------请选择-------------</option>
                                {volist name="wdzxs" id="wd" }
                                <option value="{$wd.id}">{$wd.name}</option>
                                {/volist}
                            </select>
                        </td>
                        <td>
                            <span class="tit">前台咨询师：</span>
                            <select id="disease" class="easyui-combobox" name="disease" data-options="required:true,panelHeight:'auto',editable:false" validType="comboxValidate['disease','请选择咨询病种']">
                                <option value="0">--------------请选择-------------</option>
                                {volist name="qtzxs" id="qt" }
                                <option value="{$qt.id}">{$qt.name}</option>
                                {/volist}
                            </select>
                        </td>
                        <td>
                            <span class="tit">接诊医生：</span>
                            <select class="easyui-combobox" name="doctor" data-options="panelHeight:'auto',editable:false">
                                <option value="0">--------------请选择-------------</option>
                                {volist name="doctors" id="d" }
                                <option value="{$d.id}">{$d.doctor}</option>
                                {/volist}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="tit">就诊&ensp;&ensp;病种：</span>
                            <select id="disease" class="easyui-combobox" name="disease" data-options="required:true,panelHeight:'auto',editable:false" validType="comboxValidate['disease','请选择咨询病种']">
                                <option value="0">--------------请选择-------------</option>
                                {volist name="disease" id="c" }
                                <option value="{$c.id}">{$c.disease_name}</option>
                                {/volist}
                            </select>
                        </td>
                        <td>
                            <span class="tit">初诊&ensp;&ensp;日期：</span>
                            <input name="jz_time" id="jz_time" class="easyui-datebox"></input>
                        </td>
                        <td>
                            <span class="tit">消费金额：</span>
                            <input type="text" class="easyui-textbox" value="0">
                        </td>

                    </tr>
                    <tr>
                        <td>
                            <span class="tit">病情描述：</span>
                            <textarea class="" name="comment" id="" cols="21" rows="5"></textarea>
                        </td>
                    </tr>
                    <!-- <tr>
                        <td>
                            <input type="submit" class="easyui-linkbutton" value="保存">
                        </td>
                        <td>
                            <input type="reset" class="easyui-linkbutton" value="重置">
                        </td>
                    </tr> -->
                </table>
            </form>
            <div style="text-align:center;padding:5px">
                <a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()" style="width: 90px">保存</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()" style="width: 90px">重置</a>
            </div>
            <div style="color: red;font-size: 16px;margin-top: 20px;"><span id="getmsg"></span></div>
            </div>
        </div>
    </center>
        <script>
            function submitForm(){
                $('#useradd').form('submit',{
                    onSubmit:function(){
                        return $(this).form('enableValidation').form('validate');
                    },
                    success:function(data){
                        // console.log(data);
                        if(data=='客户添加成功!'){
                            clearForm();
                        }
                        $('#getmsg').html('操作提示：'+data);
                    }

                });
            }
            function clearForm(){
                $('#useradd').form('reset');
                // $('#useradd')[0].reset();
            }

            $(function(){
                var birthday=$('#birthday');
                birthday.datebox().datebox('calendar').calendar({
                    validator: function(date){
                        var now = new Date();
                        var d1 = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        return d1>=date;
                    }
                });

                // 下拉列表扩展验证
                $.extend($.fn.validatebox.defaults.rules, {
                    comboxValidate : {
                        validator : function(value, param,missingMessage) {
                            if($('#'+param).combobox('getValue')!='' && $('#'+param).combobox('getValue')!=null){
                                return true;
                            }
                            return false;
                        },
                        message : "{1}"
                    }
                });

                // 开发渠道、信息来源联动
                var $dev=$('#dev');

                $dev.combobox({
                    onChange:function(newValue,oldValue){
                        //信息来源
                        var pid = newValue;
                        // console.info(pid);
                        $.getJSON('{:url('link')}?id='+pid,function(result){
                            var data = $.makeArray(result);
                            // data.unshift({"id":"","from":"--------------请选择-------------"});
                            // console.info(data);
                            $('#from').combobox({
                                valueField:'id', //值字段
                                textField:'from', //显示的字段
                                data:data,
                                panelHeight:'auto',
                                required:true,
                                editable:false,//不可编辑，只能选择
                                value:'请选择信息来源'
                            });
                            // $('#from').combobox('setValue' , '');
                        });

                    }
                });

                // 联动
                /*$('#dev').combobox({
                    onChange:function(){
                        var pid = $('#dev').combobox('getValue');

                        //信息来源
                        $('#from').combobox({
                            valueField:'id', //值字段
                            textField:'from', //显示的字段
                            url:'{:url('link')}?id='+pid,
                            panelHeight:'auto',
                            required:true,
                            editable:false,//不可编辑，只能选择
                            value:'--------------请选择-------------'
                        });
                        $('#from').combobox('setValue','');
                    }
                });*/

                //省市区三级联动
                var $province = $('#userAttrArea');
                var $city = $('#userAttrCity');
                var $County = $('#userAttrCounty');
                var provinceId = $province.combobox({
                    editable:false,
                    onChange:function(newValue, oldValue){
                        //刷新数据，重新读取城市，并清空当前输入的值
                        $County.combobox('clear');
                        if(newValue != ""){
                            var city = $city.combobox({
                                editable:false,
                                disabled:false,
                                url:'{:url('citylink')}?province_id='+newValue,
                                valueField:'city_id',
                                textField:'city_name',
                                value:'请选择市',
                                onLoadSuccess:function(){ //第2选中
                                    var combobox = $city.combobox('getData');

                                    // console.log(combobox);
                                    // $city.combobox('setText',combobox[1].city_name).combobox('setValue',combobox[1].city_id);
                                },
                                onChange:function(newValue, oldValue){
                                        // var cityid=newValue;
                                    if(newValue != ""){
                                        // console.log(newValue)
                                        //刷新数据，重新读取区县，并清空当前输入的值
                                        $County.combobox({
                                            editable:false,
                                            disabled:false,
                                            url:'{:url('countylink')}?city_id='+newValue,
                                            valueField:'county_id',
                                            textField:'county_name',
                                            value:'请选择区县',
                                            /*onLoadSuccess:function(){ //第2选中
                                                var combobox = $County.combobox('getData');
                                                $County.combobox('setText',combobox[1].name).combobox('setValue',combobox[1].id);
                                            }  */

                                        });//.combobox('clear');

                                    }
                                }
                            });//.combobox('clear');   .combobox('select','510100')
                        }
                    }
                }).combobox('select','510000');



            })


        </script>
</body>
</html>
